{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <title>Courses • Rabbani CiC</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Fonts & Icons (match index) -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&family=Cormorant+Garamond:ital,wght@0,600;1,600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

  <style>
    :root{
      --rcic-blue:#1e3a8a;
      --rcic-blue-600:#2747a8;
      --rcic-ink:#0f172a;
      --rcic-slate:#334155;
      --rcic-light:#f8fafc;
      --line:#e5e7eb;
      --glass: rgba(255,255,255,.08);
      --card-border: rgba(255,255,255,.14);
    }
    html,body{scroll-behavior:smooth}
    body{
      font-family:"Poppins",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:var(--rcic-light);
      color:var(--rcic-ink);
    }

    /* ===== NAV (translucent, like index) ===== */
    .navbar{
      position:sticky; top:0; z-index:1030;
      background:rgba(15,23,42,.70); backdrop-filter: blur(8px);
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    .brand-title{
      font-family:"Cormorant Garamond",serif; font-style:italic; font-weight:600; color:#fff; margin:0;
      letter-spacing:.3px; font-size:1.6rem;
    }
    .navbar .nav-link{ color:#e2e8f0 !important; font-weight:500 }
    .navbar .nav-link:hover{ color:#fff !important; text-decoration:underline }

    .btn-grad{
      background:linear-gradient(135deg,var(--rcic-blue),var(--rcic-blue-600));
      border:0; color:#fff; font-weight:600;
      box-shadow:0 12px 26px rgba(30,58,138,.35);
    }

    /* ===== HERO (glass over image, same asset as index) ===== */
    .hero{
      color:#fff;
      background:
        linear-gradient(180deg, rgba(15,23,42,.78), rgba(15,23,42,.92)),
        url("{% static 'img/head11.jpg' %}") center/cover no-repeat;
    }
    .hero h1{ font-size:clamp(1.8rem,4vw,2.6rem) }
    .hero p{ color:#e2e8f0; max-width:880px }
    .glass{
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.18);
      border-radius:16px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      box-shadow:0 20px 60px rgba(0,0,0,.18);
    }

    /* ===== TOOLBAR ===== */
    .tools{
      background:#fff; border:1px solid #eef1f6; border-radius:16px;
      box-shadow:0 14px 36px rgba(0,0,0,.08);
    }
    .chip{
      border:1px solid #e2e8f0; background:#f8fafc; color:#334155;
      border-radius:999px; padding:8px 12px; font-weight:600; cursor:pointer;
      transition: all .18s ease;
    }
    .chip.active{ background:#eef2ff; color:var(--rcic-blue); border-color:#c7d2fe }
    .chip:hover{ transform:translateY(-1px) }

    /* ===== COURSE CARD (modern, glowing border) ===== */
    .course-card{
      position:relative; overflow:hidden; border-radius:16px; height:100%;
      background:#0f172a; /* base for glow; content layer is white */
      border:1px solid #0f172a;
    }
    .course-card::before{
      content:"";
      position:absolute; inset:-2px;
      background: conic-gradient(from 180deg at 50% 50%,
                  #2b4bff66, #5b8aff66, #8ec5ff66, #2b4bff66);
      filter: blur(14px);
      opacity:.55;
      transition: opacity .25s ease;
    }
    .course-card:hover::before{ opacity:.85 }
    .course-inner{
      position:relative; z-index:1; height:100%;
      background:#fff; border-radius:14px; margin:2px; display:flex; flex-direction:column;
      border:1px solid #eef1f6; box-shadow:0 10px 28px rgba(0,0,0,.06);
    }

    .banner{
      height:120px; position:relative;
      background:linear-gradient(135deg,var(--rcic-blue),var(--rcic-blue-600));
    }
    .badge-cat{
      position:absolute; right:12px; top:12px;
      background:#fff; color:var(--rcic-blue);
      border:1px solid #e5e7eb; font-weight:700; font-size:.8rem;
      padding:6px 10px; border-radius:999px;
    }
    .avatar{
      position:absolute; left:14px; bottom:-30px;
      width:64px; height:64px; border-radius:16px;
      display:grid; place-items:center;
      background:#fff; color:var(--rcic-blue); border:1px solid #e5e7eb;
      font-weight:800; font-size:1.1rem;
      box-shadow:0 12px 20px rgba(0,0,0,.12);
    }

    .card-body-custom{ padding:38px 16px 16px 16px }
    @media(min-width:768px){ .card-body-custom{ padding:38px 22px 20px 22px } }

    .title{ font-size:1.04rem; margin:0 }
    .desc{ color:#64748b; margin:.35rem 0 0 0 }

    .meta{ margin-top:auto; display:flex; gap:8px; flex-wrap:wrap }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      background:#f1f5f9; border:1px solid #e2e8f0; color:#334155;
      border-radius:999px; padding:6px 10px; font-size:.86rem; font-weight:700;
    }
    .actions{ display:grid; gap:8px; margin-top:10px }
    .btn-outline-slate{
      border:1px solid #cbd5e1; color:#334155; font-weight:600;
      background:#fff;
    }
    .btn-outline-slate:hover{ background:#f8fafc }

    /* ===== EMPTY ===== */
    .empty{
      background:#fff; border:1px solid #eef1f6; border-radius:16px; padding:28px;
      box-shadow:0 14px 36px rgba(0,0,0,.08); text-align:center; color:#64748b;
    }
  </style>
</head>
<body>

  <!-- NAV -->
  <nav class="navbar navbar-expand-lg">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center gap-2" href="{% url 'index' %}">
        <img src="{% static 'img/aa.png' %}" alt="Rabbani CiC logo" width="36" height="36">
        <span class="brand-title">Rabbani CiC</span>
      </a>

      <button class="navbar-toggler text-white" type="button" data-bs-toggle="collapse" data-bs-target="#nav">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="nav">
        <ul class="navbar-nav ms-auto align-items-lg-center">
          <li class="nav-item"><a class="nav-link" href="{% url 'index' %}">Home</a></li>
          <li class="nav-item"><a class="nav-link" href="{% url 'courses_list' %}">Courses</a></li>
          {% if user.is_authenticated %}
            <li class="nav-item ms-lg-3"><a class="btn btn-sm btn-light fw-semibold" href="{% url 'dashboard' %}">Dashboard</a></li>
            <form method="post" action="{% url 'logout' %}" class="brand-actions">
              {% csrf_token %}
              <button type="submit" class="btn btn-sm btn-grad fw-semibold m-2"  title="Logout" aria-label="Logout">Logout</button>
            </form>
          {% else %}
          <li class="nav-item ms-lg-2"><a class="btn btn-sm btn-grad fw-semibold" href="{% url 'login' %}">Login</a></li>
          <li class="nav-item ms-lg-2"><a class="btn btn-sm btn-light fw-semibold" href="{% url 'register' %}">Sign up</a></li>
          {% endif %}
        </ul>
      </div>
    </div>
  </nav>

  <!-- HERO -->
  <header class="hero">
    <div class="container py-5">
      <div class="glass p-4 p-md-5">
        <h1 class="mb-2">Explore our courses</h1>
        <p class="mb-0">Practical, accredited learning with mentor support. Pick a path and start today.</p>
      </div>
    </div>
  </header>

  <!-- TOOLBAR -->
  <section class="py-3">
    <div class="container">
      <div class="tools p-3 p-md-4">
        <form class="row g-2 align-items-center" method="get" id="filterForm">
          <div class="col-12 col-lg">
            <div class="input-group">
              <span class="input-group-text bg-white"><i class="fa-solid fa-magnifying-glass"></i></span>
              <input type="text" name="q" value="{{ request.GET.q }}" class="form-control" placeholder="Search by title or category" id="qInput">
            </div>
          </div>
          <div class="col-12 col-lg-auto d-flex gap-2">
            <button class="btn btn-grad">Search</button>
            {% if request.GET.q %}
              <a class="btn btn-outline-secondary" href="{% url 'courses_list' %}">Clear</a>
            {% endif %}
          </div>
          <div class="col-12">
            <!-- dynamic chips (built from categories on the page) -->
            <div class="d-flex flex-wrap gap-2 mt-2" id="chips"></div>
          </div>
          <div class="col-12 col-lg-auto ms-lg-auto text-muted small">
            <i class="fa-regular fa-folder-open me-1"></i>
            {{ courses|length }} course{{ courses|length|pluralize }}
          </div>
        </form>
      </div>
    </div>
  </section>

  <!-- GRID -->
  <main class="container my-4">
    <div class="row g-4" id="courseGrid">
      {% for c in courses %}
      <div class="col-12 col-sm-6 col-lg-4 course-col" data-cat="{{ c.category|default:'Uncategorised' }}">
        <article class="course-card h-100">
          <div class="course-inner">
            <!-- Banner -->
            <div class="banner">
              {% if c.category %}
                <span class="badge-cat">{{ c.category }}</span>
              {% endif %}
              <div class="avatar js-initials" data-title="{{ c.title }}"></div>
            </div>

            <!-- Body -->
            <div class="card-body-custom d-flex flex-column">
              <h2 class="title">{{ c.title }}</h2>
              {% if c.short_desc %}
                <p class="desc">{{ c.short_desc|truncatechars:140 }}</p>
              {% else %}
                <p class="desc">Learn with hands-on modules, quizzes and mentor support.</p>
              {% endif %}

              <div class="meta mt-2">
                <span class="pill"><i class="fa-regular fa-square"></i> Modules: <strong>{{ c.n_modules }}</strong></span>
                <span class="pill"><i class="fa-regular fa-circle-play"></i> Lessons: <strong>{{ c.n_lessons }}</strong></span>
              </div>

              <div class="actions">
                <a class="btn btn-grad" href="{% url 'course_enroll' c.slug %}">
                  <i class="fa-regular fa-eye me-1"></i> View details
                </a>
                {% if user.is_authenticated and c.slug in enrolled_slugs %}
                  <a class="btn btn-outline-slate" href="{% url 'course_detail' c.slug %}">
                    <i class="fa-solid fa-arrow-right-to-bracket me-1"></i> Go to course
                  </a>
                {% endif %}
              </div>
            </div>
          </div>
        </article>
      </div>
      {% empty %}
        <div class="col-12">
          <div class="empty">
            <i class="fa-regular fa-face-smile-beam fa-2x mb-2"></i>
            <p class="mb-2">No active courses yet.</p>
            <a class="btn btn-grad" href="{% url 'index' %}">Back to home</a>
          </div>
        </div>
      {% endfor %}
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Initials in the avatar from course title (e.g., "Web Development" → "WD")
    document.querySelectorAll('.js-initials').forEach(el=>{
      const t = (el.dataset.title || '').trim();
      const parts = t.split(/\s+/).slice(0,2);
      const letters = parts.map(p=>p[0]?.toUpperCase()||'').join('');
      el.textContent = letters || 'C';
    });

    // Build category chips dynamically from cards
    const grid = document.getElementById('courseGrid');
    const chipWrap = document.getElementById('chips');
    const cols = Array.from(document.querySelectorAll('.course-col'));
    const cats = Array.from(new Set(cols.map(c => (c.dataset.cat||'Uncategorised')))).sort();
    const makeChip = (label, active=false) => {
      const b = document.createElement('button');
      b.type = 'button';
      b.className = 'chip' + (active ? ' active' : '');
      b.textContent = label;
      b.dataset.cat = label;
      b.addEventListener('click', ()=>{
        Array.from(chipWrap.querySelectorAll('.chip')).forEach(x=>x.classList.remove('active'));
        b.classList.add('active');
        filter(label);
      });
      return b;
    };
    if (cats.length){
      chipWrap.appendChild(makeChip('All', true));
      cats.forEach(c => chipWrap.appendChild(makeChip(c)));
    }

    function filter(cat){
      cols.forEach(col=>{
        const ok = (cat==='All') || (col.dataset.cat===cat);
        col.style.display = ok ? '' : 'none';
      });
    }

    // If user typed a search, also client-filter instantly (in addition to server)
    const qInput = document.getElementById('qInput');
    if(qInput){
      qInput.addEventListener('input', ()=>{
        const q = qInput.value.trim().toLowerCase();
        cols.forEach(col=>{
          const txt = col.innerText.toLowerCase();
          col.style.display = txt.includes(q) ? '' : 'none';
        });
      });
    }
  </script>
</body>
</html>
