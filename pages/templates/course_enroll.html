{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <title>{{ course.title }} • Rabbani CiC</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Fonts & Icons (match index) -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&family=Cormorant+Garamond:ital,wght@0,600;1,600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

  <style>
    :root{
      --rcic-blue:#1e3a8a;
      --rcic-blue-600:#2747a8;
      --rcic-ink:#0f172a;
      --rcic-slate:#334155;
      --rcic-light:#f8fafc;
      --line:#e5e7eb;
    }
    html,body{scroll-behavior:smooth}
    body{
      font-family:"Poppins",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:var(--rcic-light);
      color:var(--rcic-ink);
    }

    /* NAV (same vibe as index) */
    .navbar{
      position:sticky; top:0; z-index:1030;
      background:rgba(15,23,42,.70); backdrop-filter: blur(8px);
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    .brand-title{
      font-family:"Cormorant Garamond",serif; font-style:italic; font-weight:600; color:#fff; margin:0;
      letter-spacing:.3px; font-size:1.6rem;
    }
    .navbar .nav-link{ color:#e2e8f0 !important; font-weight:500 }
    .navbar .nav-link:hover{ color:#fff !important; text-decoration:underline }

    .btn-grad{
      background:linear-gradient(135deg,var(--rcic-blue),var(--rcic-blue-600));
      border:0; color:#fff; font-weight:600;
      box-shadow:0 12px 26px rgba(30,58,138,.35);
    }
    .btn-outline-slate{
      border:1px solid #cbd5e1; color:#334155; font-weight:600; background:#fff;
    }
    .btn-outline-slate:hover{ background:#f8fafc }

    /* HERO (glassy over image) */
    .hero{
      color:#fff;
      background:
        linear-gradient(180deg, rgba(15,23,42,.78), rgba(15,23,42,.92)),
        url("{% static 'img/head11.jpg' %}") center/cover no-repeat;
    }
    .glass{
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.18);
      border-radius:16px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      box-shadow:0 20px 60px rgba(0,0,0,.18);
    }
    .crumb a{ color:#e2e8f0; text-decoration:none }
    .crumb a:hover{ text-decoration:underline }

    .badge-cat{
      display:inline-block; background:#fff; color:var(--rcic-blue);
      border:1px solid #e5e7eb; font-weight:700; font-size:.8rem;
      padding:6px 10px; border-radius:999px;
    }

    /* LAYOUT */
    .content-card{
      background:#fff; border:1px solid #eef1f6; border-radius:16px;
      box-shadow:0 14px 36px rgba(0,0,0,.08);
    }
    .stat{
      background:#fff; border:1px solid #e5e7eb; border-radius:14px; padding:12px 14px;
      min-width:120px;
    }
    .stat .num{ font-size:1.25rem; font-weight:800 }

    .sticky-md-top{ top:90px } /* make sidebar sticky below navbar */

    /* ACCORDION / CURRICULUM */
    .accordion-button{ font-weight:600 }
    .lesson{ display:flex; gap:10px; align-items:center; color:#475569 }
    .lesson i{ color:var(--rcic-blue) }

    .included li{ margin:.25rem 0 }

    /* subtle animated underline for anchor links */
    .anchor-link{ position:relative; text-decoration:none }
    .anchor-link::after{
      content:""; position:absolute; left:0; bottom:-2px; width:0; height:2px; background:var(--rcic-blue);
      transition: width .25s ease;
    }
    .anchor-link:hover::after{ width:100% }
  </style>
</head>
<body>

  <!-- NAV -->
  <nav class="navbar navbar-expand-lg">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center gap-2" href="{% url 'index' %}">
        <img src="{% static 'img/aa.png' %}" alt="Rabbani CiC logo" width="36" height="36">
        <span class="brand-title">Rabbani CiC</span>
      </a>

      <button class="navbar-toggler text-white" type="button" data-bs-toggle="collapse" data-bs-target="#nav">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="nav">
        <ul class="navbar-nav ms-auto align-items-lg-center">
          <li class="nav-item"><a class="nav-link" href="{% url 'index' %}">Home</a></li>
          <li class="nav-item"><a class="nav-link" href="{% url 'courses_list' %}">Courses</a></li>
          {% if user.is_authenticated %}
            <li class="nav-item ms-lg-3"><a class="btn btn-sm btn-light fw-semibold" href="{% url 'dashboard' %}">Dashboard</a></li>
            <form method="post" action="{% url 'logout' %}" class="brand-actions">
              {% csrf_token %}
              <button type="submit" class="btn btn-sm btn-grad fw-semibold m-2"  title="Logout" aria-label="Logout">Logout</button>
            </form>
          {% else %}
          <li class="nav-item ms-lg-2"><a class="btn btn-sm btn-grad fw-semibold" href="{% url 'login' %}">Login</a></li>
          <li class="nav-item ms-lg-2"><a class="btn btn-sm btn-light fw-semibold" href="{% url 'register' %}">Sign up</a></li>
          {% endif %}
        </ul>
      </div>
    </div>
  </nav>

  <!-- HERO -->
  <header class="hero py-5">
    <div class="container">
      <div class="glass p-4 p-md-5">
        <div class="crumb small mb-2">
          <a href="{% url 'courses_list' %}">Courses</a> <span class="mx-1">›</span> {{ course.title }}
        </div>
        <div class="d-flex flex-wrap align-items-center justify-content-between gap-2">
          <div>
            <h1 class="mb-1" style="font-family:'Cormorant Garamond',serif;font-style:italic;font-weight:600;">
              {{ course.title }}
            </h1>
            <p class="mb-0" style="max-width:880px;">
              {{ course.short_desc|default:"Start learning with hands-on modules, quizzes and mentor support." }}
            </p>
          </div>
          {% if course.category %}
            <span class="badge-cat">{{ course.category }}</span>
          {% endif %}
        </div>
        <div class="d-flex flex-wrap gap-2 mt-3">
          <a class="anchor-link text-white-50" href="#curriculum"><i class="fa-regular fa-list-check me-1"></i> Curriculum</a>
          <span class="text-white-50">•</span>
          <a class="anchor-link text-white-50" href="#includes"><i class="fa-regular fa-square-check me-1"></i> What’s included</a>
          <span class="text-white-50">•</span>
          <a class="anchor-link text-white-50" href="#enroll"><i class="fa-regular fa-circle-play me-1"></i> Enroll</a>
        </div>
      </div>
    </div>
  </header>

  <!-- BODY -->
  <main class="container my-4 my-md-5">
    <div class="row g-4">
      <!-- LEFT: details -->
      <div class="col-lg-8">
        <!-- Stats -->
        <div class="d-flex flex-wrap gap-2 mb-3">
          <div class="stat">
            <div class="small text-muted">Modules</div>
            <div class="num">{{ n_modules }}</div>
          </div>
          <div class="stat">
            <div class="small text-muted">Lessons</div>
            <div class="num">{{ n_lessons }}</div>
          </div>
        </div>

        <!-- Curriculum -->
        <section id="curriculum" class="content-card p-3 p-md-4">
          <h2 class="h5 mb-3">Curriculum</h2>
          {% if modules %}
            <div class="accordion" id="currAcc">
              {% for m in modules %}
              <div class="accordion-item">
                <h2 class="accordion-header" id="mh{{ forloop.counter }}">
                  <button class="accordion-button {% if not forloop.first %}collapsed{% endif %}" type="button"
                          data-bs-toggle="collapse" data-bs-target="#mc{{ forloop.counter }}"
                          aria-expanded="{{ forloop.first|yesno:'true,false' }}" aria-controls="mc{{ forloop.counter }}">
                    Module {{ m.index }}: {{ m.title }}
                    <span class="ms-2 small text-muted">({{ m.lessons.count }} lesson{{ m.lessons.count|pluralize }})</span>
                  </button>
                </h2>
                <div id="mc{{ forloop.counter }}" class="accordion-collapse collapse {% if forloop.first %}show{% endif %}"
                     aria-labelledby="mh{{ forloop.counter }}" data-bs-parent="#currAcc">
                  <div class="accordion-body">
                    {% if m.intro %}<p class="text-secondary mb-2">{{ m.intro }}</p>{% endif %}
                    {% if m.lessons.count %}
                      <ul class="list-unstyled mb-0">
                        {% for l in m.lessons.all %}
                          <li class="lesson"><i class="fa-regular fa-circle-play"></i> <span>{{ l.title }}</span></li>
                        {% endfor %}
                      </ul>
                    {% else %}
                      <div class="text-muted">Lessons will be published soon.</div>
                    {% endif %}
                  </div>
                </div>
              </div>
              {% endfor %}
            </div>
          {% else %}
            <div class="text-muted">Curriculum will be published soon.</div>
          {% endif %}
        </section>

        <!-- Included -->
        <section id="includes" class="content-card p-3 p-md-4 mt-3">
          <h2 class="h6 mb-2">What’s included</h2>
          <ul class="included text-secondary mb-0">
            <li><i class="fa-solid fa-check text-success me-2"></i> Self-paced modules with quizzes</li>
            <li><i class="fa-solid fa-check text-success me-2"></i> Mentor support & community</li>
            <li><i class="fa-solid fa-check text-success me-2"></i> CPD-recognised certificate</li>
            <li><i class="fa-solid fa-check text-success me-2"></i> Pause anytime—your progress is saved</li>
          </ul>
        </section>
      </div>

      <!-- RIGHT: enroll card -->
      <aside class="col-lg-4">
        <div id="enroll" class="content-card p-3 p-md-4 sticky-md-top">
          <h2 class="h6 mb-2">Enroll</h2>

          {% if is_enrolled %}
            <div class="alert alert-success py-2 d-flex align-items-center gap-2">
              <i class="fa-solid fa-circle-check"></i> You’re already enrolled.
            </div>
            <a class="btn btn-grad w-100" href="{{ continue_link }}">
              <i class="fa-solid fa-arrow-right-to-bracket me-1"></i> Go to course
            </a>
          {% else %}
            <p class="small text-muted">Join now to unlock the full learning view and track your progress.</p>
            <a class="btn btn-grad w-100" href="{{ enroll_link }}">
              <i class="fa-regular fa-circle-play me-1"></i> Enroll now
            </a>
            {% if not user.is_authenticated %}
              <div class="small text-muted mt-2">You’ll be asked to log in / sign up first.</div>
            {% endif %}
          {% endif %}

          <hr class="my-3">

          <!-- Trust badges -->
          <div class="small text-muted">
            <div class="d-flex flex-column gap-2">
              <div><i class="fa-solid fa-shield-check text-success me-2"></i> CPD-accredited</div>
              <div><i class="fa-solid fa-users text-primary me-2"></i> Trusted by 2,500+ learners</div>
              <div><i class="fa-solid fa-star text-warning me-2"></i> 4.8/5 learner satisfaction</div>
            </div>
          </div>

          <hr class="my-3">
          <div class="small text-muted">
            <strong>Need help?</strong> <a href="{% url 'index' %}#contact" class="text-decoration-none">Talk to an advisor</a>
          </div>
        </div>
      </aside>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
