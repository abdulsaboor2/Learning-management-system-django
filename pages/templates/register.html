{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
 
  <title>Sign up • Rabbani CiC</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">

  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

  <style>
    :root {
      --rcic-blue: #1e3a8a;
      /* brand blue */
      --rcic-blue-600: #2747a8;
      /* hover blue */
      --rcic-ink: #0f172a;
      /* near-black */
      --rcic-slate: #334155;
      /* slate */
      --rcic-bg: #f6f7fb;
      /* page bg */
    }

    body {
      font-family: "Poppins", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:
        radial-gradient(1200px 600px at 120% -10%, rgba(39, 71, 168, .12), rgba(0, 0, 0, 0) 60%),
        radial-gradient(1000px 500px at -20% 120%, rgba(30, 58, 138, .12), rgba(0, 0, 0, 0) 60%),
        var(--rcic-bg);
      color: var(--rcic-ink);
      min-height: 100vh;
      display: grid;
      place-items: center;
      padding: 24px 14px;
    }

    .auth-card {
      width: 100%;
      max-width: 880px;
      background: #fff;
      border: 1px solid #eef1f6;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, .08);
      overflow: hidden;
    }
    
    .left{
      background:
        linear-gradient(135deg, rgba(15,23,42,.85), rgba(15,23,42,.92)),
        url("{% static 'img/head11.jpg' %}") center/cover no-repeat;
      color:#fff;
    }

    .left .brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .left .brand img {
      width: 36px;
      height: 36px
    }

    .left .headline {
      font-size: clamp(1.2rem, 2.6vw, 1.6rem);
      font-weight: 600;
    }

    .left .bullets {
      list-style: none;
      padding-left: 0;
      margin: 0;
    }

    .left .bullets li {
      display: flex;
      gap: 10px;
      align-items: flex-start;
      margin: .4rem 0;
    }

    .left .bullets i {
      color: #93c5fd
    }

    .right {
      background: #fff
    }

    .form-label {
      font-weight: 600;
      color: #334155
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--rcic-blue), var(--rcic-blue-600));
      border: 0;
      box-shadow: 0 10px 22px rgba(30, 58, 138, .25);
      font-weight: 600;
    }

    .btn-primary:hover {
      filter: brightness(.98)
    }

    .btn-icon {
      border: 1px solid #e2e8f0;
      background: #fff;
      font-weight: 600;
    }

    .btn-icon i {
      margin-right: 8px
    }

    .input-group-text {
      background: #fff
    }

    .form-control:focus {
      box-shadow: 0 0 0 .2rem rgba(30, 58, 138, .15);
      border-color: #cbd5e1
    }

    .strength {
      height: 8px;
      background: #e9eef7;
      border-radius: 999px;
      overflow: hidden;
    }

    .strength>span {
      display: block;
      height: 100%;
      width: 0%;
      background: linear-gradient(135deg, #f59e0b, #16a34a);
      transition: width .25s ease;
    }

    .checklist {
      list-style: none;
      padding-left: 0;
      margin: .4rem 0 0 0;
      font-size: .9rem;
      color: #64748b;
    }

    .checklist li {
      display: flex;
      gap: 6px;
      align-items: center;
      margin: .15rem 0
    }

    .checklist i {
      width: 16px
    }

    .checklist .ok {
      color: #16a34a
    }

    .checklist .bad {
      color: #94a3b8
    }

    .small-muted {
      color: #6b7280;
      font-size: .9rem
    }

    .link {
      color: var(--rcic-blue);
      text-decoration: none;
      font-weight: 600
    }

    .link:hover {
      text-decoration: underline
    }

    .or {
      display: flex;
      align-items: center;
      gap: 10px;
      color: #94a3b8;
      font-weight: 600;
    }

    .or::before,
    .or::after {
      content: "";
      flex: 1;
      height: 1px;
      background: #e2e8f0
    }

    @media (max-width: 992px) {
      .left {
        display: none
      }
    }
  </style>
</head>

<body>
  {% comment %} {% if user.is_authenticated %}
    <script>window.location.href = "{% url 'dashboard' %}";</script>
  {% endif %} {% endcomment %}

  <div class="auth-card">
    <div class="row g-0">
     <!-- Brand / Value Prop -->
      <aside class="col-lg-5 left p-4 p-lg-5">
        <div class="brand mb-3">
          <img src="{% static 'img/aa.png' %}" alt="Rabbani CiC logo">
          <strong>Rabbani CiC</strong>
        </div>
        <p class="headline mb-2">Create your account</p>
        <p class="mb-4">Join practical, accredited courses with mentor support.</p>
        <ul class="bullets">
          <li><i class="fa-solid fa-circle-check"></i> CPD-recognised certificates</li>
          <li><i class="fa-solid fa-circle-check"></i> Flexible, self-paced learning</li>
          <li><i class="fa-solid fa-circle-check"></i> Real projects & portfolio</li>
        </ul>
      </aside>
      <!-- Form -->
      <section class="col-lg-7 right p-4 p-lg-5">
        {# IMPORTANT: real POST; no JS redirect #}
        
        <form id="signupForm" method="post" action="{% url 'register' %}" novalidate class="needs-validation">
          {% csrf_token %}

          {% if messages %}
            {% for m in messages %}
              <div class="alert alert-{{ m.tags }} py-2">{{ m }}</div>
            {% endfor %}
          {% endif %}

          {% if form.non_field_errors %}
            <div class="alert alert-danger py-2">{{ form.non_field_errors|striptags }}</div>
          {% endif %}

          <!-- First name -->
          

          <div class="row g-3">
            <div class="col-md-6">
              <label for="firstName" class="form-label">First name</label>
              <input type="text" id="firstName" name="first_name" class="form-control"
                value="{{ form.first_name.value|default:'' }}" required minlength="2" autocomplete="given-name">
            {% for e in form.first_name.errors %}
              <div class="text-danger small">{{ e }}</div>
            {% endfor %}
            </div>

            <div class="col-md-6">
              <label for="lastName" class="form-label">Last name</label>
              <input type="text" id="lastName" name="last_name" class="form-control" value="{{ form.last_name.value|default:'' }}" required minlength="2" autocomplete="family-name">
              {% for e in form.last_name.errors %}<div class="text-danger small">{{ e }}</div>{% endfor %}
            </div>

            <div class="col-12">
              <label for="email" class="form-label">Email address</label>
              <input type="email" id="email" name="email" class="form-control" value="{{ form.email.value|default:'' }}" required autocomplete="email">
            {% for e in form.email.errors %}<div class="text-danger small">{{ e }}</div>{% endfor %}
            </div>

            <div class="col-md-6">
              <label for="password" class="form-label">Password</label>
              <div class="input-group">
                <input type="password" id="password" name="password1" class="form-control" required>
                {% for e in form.password1.errors %}<div class="text-danger small">{{ e }}</div>{% endfor %}
                <button class="btn btn-outline-secondary" type="button" id="togglePass"><i class="fa-regular fa-eye"></i></button>
              </div>
              <div class="form-text">Use 8+ chars with a number & symbol.</div>
              <!-- your strength meter JS can stay -->
            </div>

            <div class="col-md-6">
              <label for="confirm" class="form-label">Confirm password</label>
              <div class="input-group">
                <input type="password" id="confirm" name="password2" class="form-control" required>
                {% for e in form.password2.errors %}<div class="text-danger small">{{ e }}</div>{% endfor %}
                <button class="btn btn-outline-secondary" type="button" id="toggleConfirm"><i class="fa-regular fa-eye"></i></button>
              </div>
            </div>

            <div class="col-md-6">
              <label for="country" class="form-label">Country</label>
              <input type="text" id="country" name="country" class="form-control" value="{{ form.country.value|default:'' }}" placeholder="Auto-detected">
            </div>

            <div class="col-md-6">
              <label for="tz" class="form-label">Timezone</label>
              <select id="tz" name="timezone" class="form-select">
                {% if form.timezone.value %}
                  <option value="{{ form.timezone.value }}" selected>{{ form.timezone.value }}</option>
                {% else %}
                  <option value="">Select timezone</option>
                {% endif %}
              </select>
              {% for e in form.timezone.errors %}<div class="text-danger small">{{ e }}</div>{% endfor %}
            </div>

            <div class="col-12 form-check mt-2">
              <input class="form-check-input" type="checkbox" id="terms" name="terms"
              {% if form.terms.value %}checked{% endif %} required>
              {% for e in form.terms.errors %}<div class="text-danger small">{{ e }}</div>{% endfor %}
              <label class="form-check-label" for="terms">
                I agree to the <span class="link">Terms</span> and
                <span class="link">Privacy Policy</span>.
              </label>
            </div>

            <div class="col-12 d-grid mt-2">
              <button class="btn btn-primary btn-lg" type="submit">Create account</button>
            </div>

            <div class="col-12 mt-3">
              <p class="small-muted mb-0">Already have an account? <a class="link" href="{% url 'login' %}">Log in</a></p>
            </div>
          </div>
        </form>
      </section>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // ----- Password visibility
    const pass = document.getElementById('password');
    const confirm = document.getElementById('confirm');
    document.getElementById('togglePass').addEventListener('click', () => {
      pass.type = pass.type === 'password' ? 'text' : 'password';
    });
    document.getElementById('toggleConfirm').addEventListener('click', () => {
      confirm.type = confirm.type === 'password' ? 'text' : 'password';
    });

    // ----- Password strength + checklist
    const bar = document.getElementById('strengthBar');
    const cLen = document.getElementById('cLen');
    const cNum = document.getElementById('cNum');
    const cSym = document.getElementById('cSym');

    function setCheckIcon(el, ok) {
      el.className = ok ? 'fa-solid fa-check ok' : 'fa-regular fa-circle bad';
    }
    function strength(pw) {
      let score = 0;
      const hasLen = pw.length >= 8;
      const hasNum = /\d/.test(pw);
      const hasSym = /[^A-Za-z0-9]/.test(pw);
      score = (hasLen + hasNum + hasSym) / 3;
      setCheckIcon(cLen, hasLen);
      setCheckIcon(cNum, hasNum);
      setCheckIcon(cSym, hasSym);
      bar.style.width = (score * 100) + '%';
    }
    pass.addEventListener('input', () => {
      strength(pass.value);
      // live confirm match validity
      if (confirm.value.length) confirm.reportValidity();
    });

    // ----- Populate timezones
    const tzSelect = document.getElementById('tz');
    const timeZones = Intl.supportedValuesOf ? Intl.supportedValuesOf('timeZone') : [];
    let guessed = Intl.DateTimeFormat().resolvedOptions().timeZone || '';
    tzSelect.innerHTML = '<option value="">Select timezone</option>' +
      timeZones.map(z => `<option value="${z}" ${z === guessed ? 'selected' : ''}>${z}</option>`).join('');

    // ----- Geolocation (country) — best effort without external APIs
    const countryInput = document.getElementById('country');
    try {
      // Try to infer country from language
      const lang = navigator.language || '';
      const countryCode = (lang.split('-')[1] || '').toUpperCase();
      if (countryCode) countryInput.value = countryCode;
    } catch (e) { }

    // ----- Bootstrap validation + confirm match
    const form = document.getElementById('signupForm');
    function passwordsMatch() {
      return pass.value && confirm.value && pass.value === confirm.value;
    }
    confirm.addEventListener('input', () => {
      if (!passwordsMatch()) {
        confirm.setCustomValidity('Passwords do not match');
      } else {
        confirm.setCustomValidity('');
      }
    });

    form.addEventListener('submit', (e) => {
      if (!passwordsMatch()) {
        confirm.setCustomValidity('Passwords do not match');
      } else {
        confirm.setCustomValidity('');
      }

      if (!form.checkValidity()) {
        e.preventDefault();
        e.stopPropagation();
      } else {
        // Submit normally or intercept here:
        // e.preventDefault(); // if handling via fetch()
        // fetch('/api/register', { method:'POST', body: new FormData(form) })
        //   .then(r => r.json()).then(console.log);
      }
      form.classList.add('was-validated');
    });
  </script>
</body>

</html>